"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[622],{8622:(e,t,r)=>{r.r(t),r.d(t,{default:()=>h});var s=r(5155),l=r(2115);let a=(0,r(9829).io)(),n=["거래처분류","상태","안내분류","구매/렌탈","기기번호","기종","에러횟수","제품","수취인명","연락처1","연락처2","계약자주소","택배발송일","시작일","종료일","반납요청일","반납완료일","특이사항1","특이사항2","총연장횟수","신청일","0차연장","1차연장","2차연장","3차연장","4차연장","5차연장"],c={계약자주소:"주소",특이사항1:"특이사항"},o={계약자주소:360};function i(e){return"cell_styles:"+e}function d(e,t){let r=t&&"object"==typeof t?t:{},s={};return e.forEach(e=>{var t,l;s[e]=null!=(l=null!=(t=r[e])?t:o[e])?l:120}),s}function u(e){let{viewId:t="통합관리"}=e,[r,o]=(0,l.useState)([]),u=r.length?r:n,[h,f]=(0,l.useState)([]),[p,b]=(0,l.useState)(!0);(0,l.useEffect)(()=>((async()=>{try{let e=await fetch("/api/unified"),t=await e.json();Array.isArray(t)&&t.length>0?f(t):f(Array.from({length:20},()=>Object.fromEntries(u.map(e=>[e,""])))),b(!1)}catch(e){console.error("❌ 데이터 불러오기 실패:",e),b(!1)}})(),a.on("update",e=>{f(e)}),()=>{a.off("update"),a.disconnect()}),[t]);let m=async e=>{try{await fetch("/api/unified",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({rows:e})}),a.emit("update",e),console.log("✅ DB 자동저장 완료")}catch(e){console.error("❌ 자동저장 실패:",e)}},[g,j]=(0,l.useState)({}),[y,N]=(0,l.useState)({});(0,l.useEffect)(()=>{try{let e=localStorage.getItem("col_widths:GLOBAL"),t=e?JSON.parse(e):null,r=d(u,t);j(r),N(r)}catch(t){let e=d(u,null);j(e),N(e)}},[u.join("|")]);let[v,w]=(0,l.useState)({}),[k,S]=(0,l.useState)(()=>{try{return JSON.parse(localStorage.getItem(i(t))||"{}")}catch(e){return{}}});function C(e,t){return"".concat(e,":").concat(t)}return((0,l.useEffect)(()=>{localStorage.setItem(i(t),JSON.stringify(k))},[k,t]),p)?(0,s.jsx)("div",{className:"p-6 text-gray-500",children:"데이터 불러오는 중..."}):(0,s.jsxs)("div",{className:"bg-white border rounded shadow-sm subpixel-antialiased p-4",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)("button",{className:"px-2 py-1 text-xs border rounded hover:bg-gray-50",onClick:()=>{f(e=>{let t=[...e,Object.fromEntries(u.map(e=>[e,""]))];return m(t),t})},children:"행 추가"}),(0,s.jsx)("button",{className:"px-2 py-1 text-xs border rounded hover:bg-gray-50",onClick:()=>{let e=h.filter((e,t)=>!v[t]),t=e.length?e:Array.from({length:20},()=>Object.fromEntries(u.map(e=>[e,""])));f(t),m(t),w({})},children:"선택 삭제"}),(0,s.jsx)(x,{onApply:(e,t)=>{S(r=>{let s={...r};return Object.keys(v).forEach(r=>{if(v[+r])for(let l=0;l<u.length;l++){let a=C(+r,l),n={...s[a]||{}};"bg"===e?t?n.bg=t:delete n.bg:t?n.color=t:delete n.color,n.bg||n.color?s[a]=n:delete s[a]}}),s})}})]}),(0,s.jsxs)("div",{className:"text-sm text-gray-600",children:["총 ",h.length,"행"]})]}),(0,s.jsx)("div",{className:"overflow-auto max-h-[calc(100vh-180px)]",children:(0,s.jsxs)("table",{className:"min-w-[2400px] text-[12px] border-collapse",children:[(0,s.jsxs)("colgroup",{children:[(0,s.jsx)("col",{style:{width:28}}),u.map(e=>{var t;let r=Math.round(null!=(t=y[e])?t:120);return(0,s.jsx)("col",{style:{width:r+"px"}},e)})]}),(0,s.jsx)("thead",{className:"bg-gray-100 sticky top-0 z-10",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"border w-[28px] text-center",children:"✔"}),u.map(e=>{var t;return(0,s.jsx)("th",{className:"border px-1 py-1 text-left",children:null!=(t=c[e])?t:e},e)})]})}),(0,s.jsx)("tbody",{children:h.map((e,t)=>(0,s.jsxs)("tr",{children:[(0,s.jsx)("td",{className:"border text-center",children:(0,s.jsx)("input",{type:"checkbox",checked:!!v[t],onChange:e=>w(r=>({...r,[t]:e.target.checked}))})}),u.map((r,l)=>{var a;let n=null!=(a=e[r])?a:"",c=k[C(t,l)]||{};return(0,s.jsx)("td",{className:"border px-1 py-[2px]",style:{background:c.bg,color:c.color},children:(0,s.jsx)("input",{value:n,onChange:e=>{var s;return s=e.target.value,void f(e=>{let l=[...e];return l[t]={...l[t],[r]:s},m(l),l})},className:"w-full bg-transparent border-0 outline-none text-[11px]"})},l)})]},t))})]})})]})}function x(e){let{onApply:t}=e,[r,a]=(0,l.useState)(!1);return(0,s.jsxs)("div",{className:"relative inline-block",children:[(0,s.jsx)("button",{className:"px-2 py-1 text-xs border rounded hover:bg-gray-50",onClick:()=>a(e=>!e),children:"색상"}),r&&(0,s.jsxs)("div",{className:"absolute left-0 mt-1 bg-white border rounded shadow p-2 z-30",children:[(0,s.jsx)("div",{className:"grid grid-cols-4 gap-1 mb-2",children:["#fef08a","#fca5a5","#86efac","#93c5fd","#c7d2fe","#f9a8d4","#f5f5f5","#ffffff"].map(e=>(0,s.jsx)("button",{className:"w-5 h-5 border rounded",style:{background:e},onClick:()=>{t("bg",e),a(!1)}},e))}),(0,s.jsxs)("div",{className:"flex gap-1",children:[(0,s.jsx)("button",{className:"px-2 py-1 border rounded text-xs",onClick:()=>t("bg"),children:"배경지우기"}),(0,s.jsx)("button",{className:"px-2 py-1 border rounded text-xs",onClick:()=>t("text","red"),children:"빨강글씨"}),(0,s.jsx)("button",{className:"px-2 py-1 border rounded text-xs",onClick:()=>t("text"),children:"글자색지우기"})]})]})]})}function h(){let[e,t]=(0,l.useState)(!1);return((0,l.useEffect)(()=>{(async()=>{try{let e=await fetch("/api/auth/me",{credentials:"include"});if(!(await e.json()).ok){window.location.href="/login";return}t(!0)}catch(e){window.location.href="/login"}})()},[]),e)?(0,s.jsx)(u,{viewId:"통합관리"}):(0,s.jsx)("div",{className:"flex items-center justify-center h-[60vh] text-gray-500",children:"통합관리 데이터를 불러오는 중입니다..."})}}}]);